# 游戏自动化脚本 - GUI版本

## 功能特性

✅ **图形化界面** - 友好的操作界面，无需命令行
✅ **脚本选择** - 下拉框选择不同的脚本，灵活切换自动化流程
✅ **全局快捷键** - F10启动、F11暂停、F12停止
✅ **实时日志** - 彩色日志显示，实时查看运行状态
✅ **暂停/恢复** - 随时暂停和恢复脚本执行
✅ **运行统计** - 显示运行次数和状态
✅ **多种输入方法** - 支持Windows API，绕过游戏检测

## 快速开始

### 方法1: 使用启动脚本（推荐）

双击运行 `启动GUI.bat`

### 方法2: 手动启动

```bash
# 1. 安装依赖
.venv\Scripts\python.exe install_gui_deps.py

# 2. 启动GUI
.venv\Scripts\python.exe gui_script.py
```

## 使用说明

### 界面说明

```
┌─────────────────────────────────────┐
│ 配置区                               │
│  - 游戏窗口标题                      │
│  - 模型路径                          │
│  - 置信度阈值                        │
│  - 选择脚本 (下拉框)                 │
├─────────────────────────────────────┤
│ 控制按钮                             │
│  [▶ 启动] [⏸ 暂停] [⏹ 停止]        │
├─────────────────────────────────────┤
│ 状态指示器                           │
│  ● 运行中 | 运行次数: 5              │
├─────────────────────────────────────┤
│ 运行日志                             │
│  [实时显示脚本执行日志]              │
└─────────────────────────────────────┘
```

### 快捷键

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| **F10** | 启动 | 开始执行脚本 |
| **F11** | 暂停/恢复 | 暂停或恢复脚本执行 |
| **F12** | 停止 | 完全停止脚本 |

### 操作流程

1. **配置参数**
   - 输入游戏窗口标题（如 "Torchlight: Infinite"）
   - 确认模型路径（默认 hjzgv1.pt）
   - 调整置信度阈值（默认 0.5）
   - 从下拉框选择要运行的脚本

2. **启动脚本**
   - 点击"启动"按钮或按 F10
   - 脚本会自动激活游戏窗口
   - 开始执行自动化流程

3. **监控运行**
   - 查看日志区域的实时输出
   - 观察状态指示器的变化
   - 运行次数会自动累加

4. **暂停/恢复**
   - 需要暂停时按 F11 或点击"暂停"
   - 再次按 F11 或点击"恢复"继续执行

5. **停止脚本**
   - 按 F12 或点击"停止"按钮
   - 脚本会安全退出

## 文件说明

| 文件 | 说明 |
|------|------|
| `gui_script.py` | 图形界面主程序 |
| `script1.py` | 核心自动化逻辑 |
| `scripts/base_script.py` | 脚本基类 |
| `scripts/` | 脚本目录，存放所有可选择的自动化脚本 |
| `screen_detector.py` | 屏幕检测模块 |
| `game_input_advanced.py` | 高级输入方法库 |
| `test_game_input.py` | 输入方法测试工具 |
| `install_gui_deps.py` | 依赖安装脚本 |
| `启动GUI.bat` | 一键启动脚本 |

## 日志颜色说明

- **黑色** - 普通信息
- **绿色** - 成功操作
- **橙色** - 警告信息
- **红色** - 错误信息
- **蓝色** - 调试信息

## 常见问题

### 1. 快捷键无效

**原因**: keyboard 库需要管理员权限

**解决方案**:
- 右键点击 `启动GUI.bat`
- 选择"以管理员身份运行"

### 2. 游戏内点击无效

**原因**: 游戏可能有反作弊保护

**解决方案**:
1. 运行测试工具找到有效的输入方法:
   ```bash
   .venv\Scripts\python.exe test_game_input.py
   ```

2. 尝试以管理员权限运行

3. 安装 pydirectinput:
   ```bash
   .venv\Scripts\pip.exe install pydirectinput
   ```

### 3. 模型加载失败

**原因**: 模型文件路径不正确

**解决方案**:
- 确认 `hjzgv1.pt` 在当前目录
- 或在界面中修改模型路径为正确路径

### 4. 检测不到游戏对象

**原因**: 置信度阈值过高

**解决方案**:
- 降低置信度阈值（如 0.3 - 0.5）
- 确保游戏画面清晰可见

## 高级功能

### 脚本选择

GUI支持从下拉框选择不同的脚本运行。所有继承自 `BaseScript` 的脚本类会自动显示在选择列表中。

- 选中脚本后，日志区域会显示脚本描述
- 脚本切换后需重新启动才能生效

### 创建自定义脚本

在 `scripts/` 目录下创建新的脚本文件，继承 `BaseScript` 类：

```python
# scripts/my_script.py
from scripts.base_script import BaseScript

class MyScript(BaseScript):
    """自定义脚本类"""

    def get_description(self):
        """返回脚本描述"""
        return "我的自定义脚本功能描述"

    def execute(self):
        """执行脚本主逻辑"""
        self.gui.log("开始执行自定义脚本", "INFO")
        # 你的自动化逻辑...
        return True  # 返回 True 继续循环，返回 False 停止
```

脚本会自动被GUI识别并显示在下拉列表中。

### 修改脚本逻辑

编辑 `gui_script.py` 中的 `execute_steps()` 方法：

```python
def execute_steps(self):
    """执行脚本步骤"""
    # 在这里添加你的自定义逻辑
    self.log("执行自定义步骤", "INFO")
    # ...
```

### 添加新的检测对象

在 `script1.py` 中使用 detector:

```python
# 检测单个对象
obj_xy = detector.get_center_by_name('object_name')

# 检测多个对象
objs = detector.get_all_centers_by_name('object_name')
```

### 切换输入方法

在 `click_pos()` 函数中设置 `use_api` 参数：

```python
# 使用 Windows API（推荐）
click_pos(pos, use_api=True)

# 使用 PyAutoGUI
click_pos(pos, use_api=False)
```

## 安全提示

⚠️ **重要提示**:
- 本脚本仅供学习和研究使用
- 使用自动化脚本可能违反游戏服务条款
- 使用前请确认游戏允许使用辅助工具
- 作者不对使用本脚本造成的任何后果负责

## 紧急停止

如果脚本失控，有以下停止方法：

1. **按 F12** - 停止脚本
2. **鼠标移到屏幕左上角** - PyAutoGUI 紧急停止
3. **关闭GUI窗口** - 强制退出
4. **Ctrl+C** - 终止程序（命令行模式）

## 技术支持

如有问题，请检查：
1. 日志输出中的错误信息
2. 游戏窗口是否正确激活
3. 模型文件是否存在
4. 是否有管理员权限

## 更新日志

### v1.1.0 (2026-02-13)
- ✅ 新增脚本选择功能
- ✅ 支持下拉框选择不同脚本
- ✅ 新增 BaseScript 脚本基类
- ✅ 选中脚本显示描述信息
- ✅ 支持自定义脚本扩展

### v1.0.0 (2026-02-12)
- ✅ 初始版本发布
- ✅ 图形化界面
- ✅ 全局快捷键支持
- ✅ 实时日志显示
- ✅ 暂停/恢复功能
- ✅ Windows API 输入支持
